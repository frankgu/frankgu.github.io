<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2016-11-05T14:02:53-04:00</updated><id>http://localhost:4000/</id><title>Dongfeng Gu</title><subtitle>A blog about technology and stuff related</subtitle><entry><title>Tensorflow: Rcnn for action detection</title><link href="http://localhost:4000/rcnn-action-detection/" rel="alternate" type="text/html" title="Tensorflow: Rcnn for action detection" /><published>2016-11-04T00:00:00-04:00</published><updated>2016-11-04T00:00:00-04:00</updated><id>http://localhost:4000/rcnn-action-detection</id><content type="html" xml:base="http://localhost:4000/rcnn-action-detection/">&lt;h1 id=&quot;github&quot;&gt;Github&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/frankgu/tensorflow_video_classification_LSTM&quot;&gt;link&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;network-structure&quot;&gt;Network structure&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/projects/rcnn.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;</content><author><name>gdf</name></author><category term="tensorflow" /><category term="lstm" /><category term="rnn" /><category term="python" /><category term="cnn" /><summary>Github</summary></entry><entry><title>Wechat: devise authentication framework</title><link href="http://localhost:4000/rails-devise-framework/" rel="alternate" type="text/html" title="Wechat: devise authentication framework" /><published>2016-10-30T00:00:00-04:00</published><updated>2016-10-30T00:00:00-04:00</updated><id>http://localhost:4000/rails-devise-framework</id><content type="html" xml:base="http://localhost:4000/rails-devise-framework/">&lt;h1 id=&quot;github&quot;&gt;Github&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/frankgu/rails_authentication_system&quot;&gt;link&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;pictures&quot;&gt;Pictures&lt;/h1&gt;

&lt;p&gt;(from left to right and top to down)&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;img src=&quot;/assets/images/projects/rails-auth.png&quot; alt=&quot;figure&quot; /&gt;&lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;/assets/images/projects/rails-auth2.png&quot; alt=&quot;figure&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;img src=&quot;/assets/images/projects/rails-auth3.png&quot; alt=&quot;figure&quot; /&gt;&lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;/assets/images/projects/rails-auth4.png&quot; alt=&quot;figure&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;img src=&quot;/assets/images/projects/rails-auth5.png&quot; alt=&quot;figure&quot; /&gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</content><author><name>gdf</name></author><category term="wechat" /><category term="devise" /><category term="rails" /><category term="ruby" /><summary>Github</summary></entry><entry><title>【译】Rails 用户认证(Authen)</title><link href="http://localhost:4000/rails-auth/" rel="alternate" type="text/html" title="【译】Rails 用户认证(Authen)" /><published>2016-10-23T00:00:00-04:00</published><updated>2016-10-23T00:00:00-04:00</updated><id>http://localhost:4000/rails-auth</id><content type="html" xml:base="http://localhost:4000/rails-auth/">&lt;h2 id=&quot;section&quot;&gt;参考链接&lt;/h2&gt;
&lt;p&gt;原文&lt;a href=&quot;https://rails.devcamp.com/professional-rails-development-course/application-build/rails-authentication&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;文章正文&lt;/h2&gt;

&lt;h3 id=&quot;authentication&quot;&gt;为什么要从用户认证（Authentication）开始&lt;/h3&gt;

&lt;p&gt;当我们决定先创建什么功能的时候，一个重要的依据就是功能之间的依赖性（dependencies）。依赖性的意思就是指不同功能之间的需求程度。功能A的依赖性高就是指有很多其他的功能需要这个功能A。下面让我们看一看我们所创建的需求表：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/functional_requirements.png&quot; alt=&quot;functional requirements&quot; /&gt;&lt;/p&gt;

&lt;p&gt;仔细阅读需求表，你将会发现几乎有一半的需求都跟&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;有关，所以我们将会从&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;的功能开始。如果你从其他的功能（比如&lt;code class=&quot;highlighter-rouge&quot;&gt;Post&lt;/code&gt;）开始，那么我们将会需要在实现&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;的功能的时候回到&lt;code class=&quot;highlighter-rouge&quot;&gt;Post&lt;/code&gt;当中来重构&lt;code class=&quot;highlighter-rouge&quot;&gt;Post&lt;/code&gt;的代码。&lt;/p&gt;

&lt;p&gt;从另一个方面来看，当我们查看数据库的&lt;code class=&quot;highlighter-rouge&quot;&gt;schema.rb&lt;/code&gt;文件时，我们将会发现数据库中有许多其他的表单将&lt;code class=&quot;highlighter-rouge&quot;&gt;user_id&lt;/code&gt;设为了外键（foreign key）。这是一个非常好的信号用来表示&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;这个表的依赖程度。所以说我们将会首先开始来创建&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;模型。&lt;/p&gt;

&lt;h3 id=&quot;devisehttpsgithubcomplataformatecdevise&quot;&gt;使用&lt;a href=&quot;https://github.com/plataformatec/devise&quot;&gt;Devise&lt;/a&gt;还是从头开始创建用户认证系统&lt;/h3&gt;

&lt;p&gt;我编写过很长一段时间的程序。到目前为止，只有两个应用程序我是从头开始创建用户认证系统而不是使用现有的用户认证系统库，类似于&lt;code class=&quot;highlighter-rouge&quot;&gt;Deivse&lt;/code&gt;。而且这两个例外的应用程序还是因为它有特定的需求，需要集成微软的&lt;code class=&quot;highlighter-rouge&quot;&gt;ActiveDirectory&lt;/code&gt;认证引擎，所以才我从头创建用户的认证系统。&lt;/p&gt;

&lt;p&gt;我个人的观点认为我们应该使用像&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;这样，经过充分测试并且会有人员长期维护的库来创建一些功能，而不是从头开始创建。在接下来的教程当中，我将会介绍如何集成&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;的每一个步骤，但我并不会介绍&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;这个&lt;code class=&quot;highlighter-rouge&quot;&gt;gem&lt;/code&gt;本身的内容，我已经写过一篇博客&lt;a href=&quot;http://blog.gdf.name/devise-usage/&quot;&gt;Devise的用法&lt;/a&gt;用来介绍有关&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;本身的内容，读者可以点进链接进行参。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;实现用户认证&lt;/h3&gt;

&lt;p&gt;我们本来可以从创建模型的&lt;code class=&quot;highlighter-rouge&quot;&gt;spec&lt;/code&gt;测试开始，但是我并不想给一些已经做过充分测试的功能再写一些重复的测试。&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;已经有一个非常详细与综合的测试系统，你可以查看测试&lt;a href=&quot;https://github.com/plataformatec/devise/tree/master/test&quot;&gt;链接&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;在我们创建新的功能之间，有一个很重要的地方需要注意的就是，我们不能在&lt;code class=&quot;highlighter-rouge&quot;&gt;mater&lt;/code&gt;分支上面直接修改代码，我们需要首先创建一个新的分支：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git checkout -b add-auth
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;将我们正在做的工作与&lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt;分支区分开来将是非常重要的，因为这样可以解决如下这种情况，当我们正在工作的时候，我们突然有另外一个非常紧急的功能需要实现，比如说修复一个错误，如果说我并没有将我现在工作放到另外一个分支当中，那么我将需要做：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;还原（reset）到一个不同的commit（有可能会产生冲突）&lt;/li&gt;
  &lt;li&gt;将我做出来的所有的改变都先注释掉（这是一个非常糟糕的注意，你将会不可避免的忘记注释掉一些代码，导致程序崩溃）&lt;/li&gt;
  &lt;li&gt;删除自己做出的所有的改变（这也是一个非常糟糕的注意，因为这将会导致自己失去之前所做的所有的工作）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;现在让我们安全的在另外一个独立的分支当中开始工作，将&lt;code class=&quot;highlighter-rouge&quot;&gt;gem&lt;/code&gt;信息添加到&lt;code class=&quot;highlighter-rouge&quot;&gt;Gemfile.rb&lt;/code&gt;当中：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Gemfile&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'devise'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 3.5'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;gt;= 3.5.5'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在运行了命令&lt;code class=&quot;highlighter-rouge&quot;&gt;bundle&lt;/code&gt;之后，我们可以运行安装器：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rails generate devise:install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首先让我们在&lt;code class=&quot;highlighter-rouge&quot;&gt;config/initializers/devise.rb&lt;/code&gt;中来更新默认的&lt;code class=&quot;highlighter-rouge&quot;&gt;mailer_sender&lt;/code&gt;设置，这将可以保证认证邮箱的发件人是我们而不是默认的地址。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/initializers/devise.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mailer_sender&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'team@dailysmarty.com'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在让我们来一步一步的进行配置：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;更新本地的邮件服务器&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/environments/development.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;action_mailer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;default_url_options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;host: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'localhost'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;port: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我们可以跳过对主页面的配置因为我们已经在博客&lt;a href=&quot;http://blog.gdf.name/rails-rspec-initial/&quot;&gt;Rails程序配置&lt;/a&gt;/&lt;a href=&quot;https://rails.devcamp.com/trails/professional-rails-development-course/campsites/application-build/guides/rails-app-configuration&quot;&gt;英文&lt;/a&gt;完成了这个步骤。现在让我们来添加警告&lt;code class=&quot;highlighter-rouge&quot;&gt;alerts&lt;/code&gt;的页面。我将不会把警告的页面添加到主页面当中，因为在有一些界面当中我们可能不想要实现警告的界面，或者说我们只想将警告的界面渲染到页面的特定位置。所以让我们在&lt;code class=&quot;highlighter-rouge&quot;&gt;view&lt;/code&gt;目录下创建一个&lt;code class=&quot;highlighter-rouge&quot;&gt;shared&lt;/code&gt;目录然后添加一个局部（partial）文件叫做&lt;code class=&quot;highlighter-rouge&quot;&gt;_alerts.html.erb&lt;/code&gt;：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%#= app/views/shared/_alerts.html.erb %&amp;gt;

&amp;lt;p class=&quot;notice&quot;&amp;gt;&amp;lt;%= notice %&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;p class=&quot;alert&quot;&amp;gt;&amp;lt;%= alert %&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在让我们简单的在&lt;code class=&quot;highlighter-rouge&quot;&gt;application.html.erb&lt;/code&gt;文件中添加一个渲染的命令，我们将会在开始设计的时候将这个命令移除：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%#= app/views/layouts/application.html.erb %&amp;gt;

&amp;lt;%= render 'shared/alerts' %&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;你发现了这种设计有多么干净吗？当我们在逐渐创建应用程序的过程当中，你将会发现我们会使用大量的局部（partial）文件来保持我们代码的干净和不重复（DRY）。现在让我们来使用以下的命令创建&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;的视图（view）：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rails g devise:views
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这段命令将会创建以下相关的视图（view）文件：
- 注册
- 登录
- 编辑账号
- 密码重设
- 邮件模板&lt;/p&gt;

&lt;p&gt;我很喜欢&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;生成器，然后它确实会创建一个我们并不需要的文件，现在让我们来删除掉那些我们不会使用的文件来避免程序显得很杂乱：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rm -rf app/views/devise/confirmations
rm -rf app/views/devise/mailer/confirmation_instructions.html.erb
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在让我们使用&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;生成器来创建&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;模型：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rails g devise User first_name:string last_name:string avatar:text username:string
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这将会创建一个默认的&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;模型，我在这个模型的迁移（migration）文件当中插入了一些新的属性：&lt;code class=&quot;highlighter-rouge&quot;&gt;first_name&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;last_name&lt;/code&gt;,&lt;code class=&quot;highlighter-rouge&quot;&gt;avatar&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;。现在让我们来运行命令&lt;code class=&quot;highlighter-rouge&quot;&gt;rake db:migrate&lt;/code&gt;来在数据库中创建相应的表和&lt;code class=&quot;highlighter-rouge&quot;&gt;schema.rb&lt;/code&gt;文件：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# db/schema.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;force: :cascade&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;email&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                  &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;encrypted_password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;reset_password_token&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;reset_password_sent_at&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;remember_created_at&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;sign_in_count&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;current_sign_in_at&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;last_sign_in_at&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inet&lt;/span&gt;     &lt;span class=&quot;s2&quot;&gt;&quot;current_sign_in_ip&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;inet&lt;/span&gt;     &lt;span class=&quot;s2&quot;&gt;&quot;last_sign_in_ip&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;first_name&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;last_name&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;text&lt;/span&gt;     &lt;span class=&quot;s2&quot;&gt;&quot;avatar&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;s2&quot;&gt;&quot;username&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                          &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                          &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;email&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;index_users_on_email&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;unique: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;using: :btree&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;reset_password_token&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;index_users_on_reset_password_token&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;unique: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;using: :btree&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;以上的教程将会给我们生成足够的代码来让用户实现注册，登录和一些其他的标准的有关用户认证的操作。在下一个博客当中我们将会讲解如何&lt;a href=&quot;http://blog.gdf.name/devise-customization/&quot;&gt;自定义Devise&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;资源&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/rails-camp/dailysmarty/tree/add-auth&quot;&gt;代码&lt;/a&gt;&lt;/p&gt;</content><author><name>gdf</name></author><category term="翻译" /><category term="devise" /><category term="rails" /><category term="ruby" /><summary>参考链接
原文链接</summary></entry><entry><title>从Tensorflow代码中理解LSTM网络</title><link href="http://localhost:4000/lstm-with-tensorflow/" rel="alternate" type="text/html" title="从Tensorflow代码中理解LSTM网络" /><published>2016-10-19T00:00:00-04:00</published><updated>2016-10-19T00:00:00-04:00</updated><id>http://localhost:4000/lstm-with-tensorflow</id><content type="html" xml:base="http://localhost:4000/lstm-with-tensorflow/">&lt;h1 id=&quot;section&quot;&gt;目录&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#rnn&quot;&gt;RNN&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#lstm&quot;&gt;LSTM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-1&quot;&gt;参考文档与引子&lt;/h2&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;缩略词&lt;/strong&gt;
&lt;br /&gt;
&lt;strong&gt;RNN&lt;/strong&gt; (&lt;a href=&quot;https://en.wikipedia.org/wiki/Recurrent_neural_network&quot;&gt;Recurrent neural network&lt;/a&gt;) 循环神经网络
&lt;br /&gt;
&lt;strong&gt;LSTM&lt;/strong&gt; (&lt;a href=&quot;https://en.wikipedia.org/wiki/Long_short-term_memory&quot;&gt;Long short-term memory&lt;/a&gt;) 长短期记忆人工神经网络&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;当我们在谷歌搜索LSTM这个关键字时，搜索结果的第一条就是一篇非常著名的博客 &lt;a href=&quot;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot;&gt;Understanding LSTM Networks&lt;/a&gt; 来介绍LSTM网络，这篇博客的作者是 &lt;a href=&quot;http://colah.github.io/about.html&quot;&gt;Christopher Olah&lt;/a&gt;，在谷歌 Google Brain 工作。这篇博客的中文翻译版为 &lt;a href=&quot;http://www.jianshu.com/p/9dc9f41f0b29&quot;&gt;[译] 理解 LSTM 网络&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.tensorflow.org/&quot;&gt;Tensorflow&lt;/a&gt;是一个由谷歌开发的基于Python语言的开源机器学习库。它具有跨平台（手机／个人电脑／服务器都可使用，CPU／GPU随意切换），高效率，高度自定义化，可以充分利用计算机性能等特点，在近几年中越来越受到机器学习研究者的喜欢，许多大公司也都在使用Tensorflow，诸如 &lt;a href=&quot;http://www.arm.com/&quot;&gt;ARM&lt;/a&gt;，&lt;a href=&quot;https://www.snapchat.com/&quot;&gt;snapchat&lt;/a&gt;，&lt;a href=&quot;https://www.uber.com/&quot;&gt;Uber&lt;/a&gt;，&lt;a href=&quot;http://www.jd.com/&quot;&gt;京东&lt;/a&gt; 等。&lt;/p&gt;

&lt;p&gt;在本篇博客中，我将尝试通过解释Tensorflow中&lt;a href=&quot;https://www.tensorflow.org/versions/r0.11/tutorials/recurrent/index.html&quot;&gt;RNN/LSTM&lt;/a&gt;部分的&lt;a href=&quot;https://github.com/tensorflow/tensorflow/tree/master/tensorflow/models/rnn/ptb&quot;&gt;源码&lt;/a&gt;来帮助大家深入理解LSTM网络的运作，同时也是为了来帮助我自己更好的理解LSTM网络。这是本人尝试写的第一篇博客，欢迎大家来加来指正文中的错误或者不合理之处，也欢迎提出各种各样的建议或意见。谢谢！&lt;/p&gt;

&lt;h2 id=&quot;lstmrnn&quot;&gt;LSTM与RNN的关系&lt;/h2&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
  &lt;p&gt;有一篇非常有名的博客&lt;a href=&quot;http://karpathy.github.io/2015/05/21/rnn-effectiveness/&quot;&gt;The Unreasonable Effectiveness of Recurrent Neural Networks&lt;/a&gt; 详细介绍了什么是RNN并且作者开源一个&lt;a href=&quot;https://github.com/karpathy/char-rnn&quot;&gt;基于LSTM的多层RNN神经网络项目&lt;/a&gt;(使用了Torch)，强烈建议没有看过的人或者对于RNN概念不是非常清楚的人进来看看。这篇博客还有中文翻译版本：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/22107715&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;LSTM从本质上来说并不是一个完整的神经网络模型，它其实是对RNN神经网络中的神经元／隐含单元（CELL／Hidden unit）的一种变形与改进。在这种改变当中，LSTM在神经元中加入了一个状态（State）的概念用来储存长期的记忆（具体LSTM结构将会在博客的后面有介绍）。在很多网上面介绍LSTM的教程或者博客当中，他们其实都只给了LSTM神经元的结构，这是属于RNN框架中的一部分。所以说如果想要理解LSTM我们首先需要理解什么是RNN。&lt;/p&gt;

&lt;h3 id=&quot;rnn&quot;&gt;RNN&lt;/h3&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
  &lt;p&gt;本篇博客的主要目的是在于将Tensorflow中的代码与LSTM和RNN的理论公式对接起来。让大家可以更容易的使用Tensorflow来开发属于自己的神经网络，或者让大家可以对LSTM与RNN有一个更加直观的从代码方面的理解。所以说本博客假设读者已经对LSTM与RNN有一定的了解，我将会直接从图片开始来解读RNN和LSTM。对于那些对RNN和LSTM没有概念的人，我建议可以从参考文档中的那篇&lt;a href=&quot;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot;&gt;博客&lt;/a&gt;开始读起。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;首先让我们从全局查看RNN神经网络是如何运作的&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/rnn_flow.png&quot; alt=&quot;RNN 网络&quot; /&gt;&lt;/p&gt;
&lt;figcaption class=&quot;caption&quot;&gt;RNN 网络&lt;/figcaption&gt;

&lt;p&gt;图中的 &lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt; 代表的是输入， &lt;script type=&quot;math/tex&quot;&gt;z&lt;/script&gt; 代表的是输出，&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt; 代表的是一段序列中任意的一个时间，&lt;script type=&quot;math/tex&quot;&gt;n&lt;/script&gt; 代表的是当前序列的总长度。&lt;/p&gt;

&lt;p&gt;下面让我们取上图中最中间的神经元为例来分析普通RNN神经元中的运作方式：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/rnn_cell.png&quot; alt=&quot;RNN 神经元／隐含单元（CELL / Hidden unit）&quot; /&gt;&lt;/p&gt;
&lt;figcaption class=&quot;caption&quot;&gt;RNN 神经元／隐含单元（CELL / Hidden unit）&lt;/figcaption&gt;

&lt;p&gt;图中的 &lt;script type=&quot;math/tex&quot;&gt;x_t&lt;/script&gt; 代表的是当前时间片段的输入， &lt;script type=&quot;math/tex&quot;&gt;z_t&lt;/script&gt; 代表的是当前时间片段的输出，&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt; 代表的是上一个时间片段的隐含状态输出，&lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt; 代表的是当前时间片段的隐含状态输出。中间的两个圆圈里的 &lt;script type=&quot;math/tex&quot;&gt;f&lt;/script&gt; 代表的意思为一个非线性的点乘操作（element-wise non-linearity），可以为一个&lt;a href=&quot;https://en.wikipedia.org/wiki/Sigmoid_function&quot;&gt;sigmoid&lt;/a&gt;操作或者是一个&lt;a href=&quot;http://mathworld.wolfram.com/HyperbolicTangent.html&quot;&gt;hyperbolic tangent&lt;/a&gt;的操作。&lt;/p&gt;

&lt;h4 id=&quot;section-2&quot;&gt;基础等式&lt;/h4&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;h_t=f(W_{xh}x_t+W_{hh}h_{t-1}+b_h)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;z_t=f(W_{hz}h_t+b_z)&lt;/script&gt;

&lt;h4 id=&quot;tensorflowgithubhttpsgithubcomtensorflowtensorflowblobmastertensorflowpythonopsrnncellpyl180-l201&quot;&gt;对应的Tensorflow代码（&lt;a href=&quot;https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/rnn_cell.py#L180-L201&quot;&gt;Github&lt;/a&gt;）&lt;/h4&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__call__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Most basic RNN: output = new_state = activation(W * input + U * state + B).&quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;variable_scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &quot;BasicRNNCell&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_activation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_num_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;上述代码块对应的就是一个普通RNN神经元中的操作&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Most basic RNN: output = new_state = activation(W * input + U * state + B).&quot;&quot;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;下面是上述代码中的变量与基础等式中的变量的对应表&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;代码变量&lt;/td&gt;
      &lt;td&gt;基础等式变量&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;new_state&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;W&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{xh}&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;input&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;x_t&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;U&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{hh}&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;state&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;B&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;b_h&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_activation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_num_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面是上述代码对应的解释&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;代码&lt;/td&gt;
      &lt;td&gt;解释&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;self._activation()&lt;/td&gt;
      &lt;td&gt;激活函数，等同于基础等式中的 &lt;script type=&quot;math/tex&quot;&gt;f&lt;/script&gt; 操作，在tensorflow的代码当中使用的是tanh的激活函数&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;a href=&quot;https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/rnn_cell.py#L867-L917&quot;&gt;_linear()&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;将传入的参数进行一个线性叠加的步骤 &lt;br /&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;_linear([a,b], num_units, True)&lt;/code&gt; = &lt;script type=&quot;math/tex&quot;&gt;Wa+Ub+B&lt;/script&gt; &lt;br /&gt; = &lt;script type=&quot;math/tex&quot;&gt;W_{a_1}a_1+W_{a_2}a_2 + ... + W_{a_n}a_n + U_{b_1}b_1 + U_{b_2}b_2 + ... + U_{b_n}b_n&lt;/script&gt; &lt;br /&gt;&lt;br /&gt;我们首先假设我们数据&lt;br /&gt;&lt;strong&gt;批尺寸&lt;/strong&gt;（batch size） = 10 &lt;br /&gt; &lt;strong&gt;输入数据大小&lt;/strong&gt;（input size）= 300&lt;br /&gt;&lt;strong&gt;隐含单元数&lt;/strong&gt;（number of unit）= 200&lt;br /&gt;那么&lt;br /&gt;&lt;script type=&quot;math/tex&quot;&gt;W&lt;/script&gt; 的大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;[输入数据大小(input size)300, 单元数(number of unit)200]&lt;/code&gt;&lt;br /&gt;&lt;script type=&quot;math/tex&quot;&gt;U&lt;/script&gt; 的大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;[隐含单元数(number of unit)200，隐含单元数(number of unit)200]&lt;/code&gt;&lt;br /&gt; &lt;script type=&quot;math/tex&quot;&gt;a&lt;/script&gt; 的大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size)10, 输入数据大小(input size)300]&lt;/code&gt;&lt;br /&gt;&lt;script type=&quot;math/tex&quot;&gt;b&lt;/script&gt; 的大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size)10, 隐含单元数(number of unit)200]&lt;/code&gt;&lt;br /&gt;&lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt; 的大小为&lt;code class=&quot;highlighter-rouge&quot;&gt;[隐含单元数(number of unit)200]&lt;/code&gt;&lt;br /&gt; （&lt;strong&gt;注意&lt;/strong&gt;：在tensorflow代码当中，实际上tensorflow做的操作是 &lt;script type=&quot;math/tex&quot;&gt;a*W+b*U+B&lt;/script&gt;。你会发现当完成操作 &lt;script type=&quot;math/tex&quot;&gt;a*W+b*U&lt;/script&gt; 时，矩阵的大小是&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size)10, 隐含单元数(number of unit)200]&lt;/code&gt;，但是 &lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt; 的大小却为&lt;code class=&quot;highlighter-rouge&quot;&gt;[隐含单元数(number of unit)200]&lt;/code&gt;，他们的大小无法匹配，但是tensorflow却可以把他们相加，这是因为tensorflow只是使用同样的 &lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt; 与矩阵中的隐含单元数相加。比如 &lt;code class=&quot;highlighter-rouge&quot;&gt;[[1,2],[3,4]] + [1,1] = [[2,3],[4,5]]&lt;/code&gt;。）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;inputs&lt;br /&gt;state&lt;/td&gt;
      &lt;td&gt;这里的inputs就等同于上面解释的 &lt;script type=&quot;math/tex&quot;&gt;a&lt;/script&gt;, 这里的state就等同于上面解释的 &lt;script type=&quot;math/tex&quot;&gt;b&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;True&lt;/td&gt;
      &lt;td&gt;加入偏移（bias） &lt;script type=&quot;math/tex&quot;&gt;B&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;lstm&quot;&gt;LSTM&lt;/h3&gt;

&lt;hr /&gt;
&lt;p&gt;下面让我们看一看LSTM，首先我们来看一下LSTM神经元的内部结构：
&lt;img src=&quot;/assets/images/posts/lstm_cell.png&quot; alt=&quot;LSTM 神经元／隐含单元（CELL / Hidden unit）&quot; /&gt;&lt;/p&gt;
&lt;figcaption class=&quot;caption&quot;&gt;LSTM 神经元／隐含单元（CELL / Hidden unit）&lt;/figcaption&gt;

&lt;p&gt;与RNN一样，图中的 &lt;script type=&quot;math/tex&quot;&gt;x_t&lt;/script&gt; 代表的是当前时间片段的输入， &lt;script type=&quot;math/tex&quot;&gt;z_t&lt;/script&gt; 代表的是当前时间片段的输出，&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt; 代表的是上一个时间片段的隐含状态输出，&lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt; 代表的是当前时间片段的隐含状态输出。LSTM相较于RNN一个主要的区别在于LSTM添加了一个新的记忆单元 &lt;script type=&quot;math/tex&quot;&gt;C&lt;/script&gt; ，图中的 &lt;script type=&quot;math/tex&quot;&gt;C_{t-1}&lt;/script&gt;代表的是上一个时间片段的（旧）记忆单元，&lt;script type=&quot;math/tex&quot;&gt;C_t&lt;/script&gt; 代表的则是当前时间片段的（新）记忆单元。图中的&lt;script type=&quot;math/tex&quot;&gt;\bigotimes&lt;/script&gt;符号代表的意思是两个向量之间的点乘，图中的&lt;script type=&quot;math/tex&quot;&gt;\bigoplus&lt;/script&gt;符号代表的意思则是两个向量之间的相加。图中圆圈里的 &lt;script type=&quot;math/tex&quot;&gt;\sigma&lt;/script&gt; 代表的意思为为一个&lt;a href=&quot;https://en.wikipedia.org/wiki/Sigmoid_function&quot;&gt;sigmoid&lt;/a&gt;操作，图中圆圈里的 &lt;script type=&quot;math/tex&quot;&gt;tanh&lt;/script&gt; 则是是一个&lt;a href=&quot;http://mathworld.wolfram.com/HyperbolicTangent.html&quot;&gt;hyperbolic tangent&lt;/a&gt;的操作。&lt;/p&gt;

&lt;h4 id=&quot;section-3&quot;&gt;基础等式&lt;/h4&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Input Gate : i_t = \sigma(W_{xi}x_t+W_{hi}h_{t-1}+b_i)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Forget Gate : f_t = \sigma(W_{xf}x_t+W_{hf}h_{t-1}+b_f)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Output Gate : o_t = \sigma(W_{xo}x_t+W_{ho}h_{t-1}+b_o)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Input Modulation Gate : g_t = tanh(W_{xc}x_t+W_{hc}h_{t-1}+b_c)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;c_t = f_t\otimes c_{t-1}+i_t\otimes g_t&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;h_t = o_t\otimes tanh(c_t)&lt;/script&gt;

&lt;h4 id=&quot;tensorflowgithubhttpsgithubcomtensorflowtensorflowblobmastertensorflowpythonopsrnncellpyl257-l324&quot;&gt;对应的Tensorflow代码（&lt;a href=&quot;https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/rnn_cell.py#L257-L324&quot;&gt;Github&lt;/a&gt;)&lt;/h4&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__call__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Long short-term memory cell (LSTM).&quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;variable_scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &quot;BasicLSTMCell&quot;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;# Parameters of gates are concatenated into one multiply for efficiency.&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_state_is_tuple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array_ops&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;concat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_num_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;c&quot;&gt;# i = input_gate, j = new_input, f = forget_gate, o = output_gate&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array_ops&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;concat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;new_c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigmoid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_forget_bias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigmoid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
               &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_activation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;new_h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_activation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigmoid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_state_is_tuple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSTMStateTuple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array_ops&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;concat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_state&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;下面列表是上面代码中的变量的大小与解释&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;变量名&lt;/td&gt;
      &lt;td&gt;对应的基础等式变量&lt;/td&gt;
      &lt;td&gt;大小（shape）&lt;/td&gt;
      &lt;td&gt;解释&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;inputs&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;x_t&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 输入数据大小(input size)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;输入的数据（&lt;script type=&quot;math/tex&quot;&gt;x_t&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;state&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;(c_{t-1},h_)&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;(&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;,&lt;br /&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;)&lt;/td&gt;
      &lt;td&gt;这个一个tuple数据类型，储存了上一个时间段也就是旧的记忆单元（&lt;script type=&quot;math/tex&quot;&gt;c_{t-1}&lt;/script&gt;）和隐含状态（&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;c&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;c_{t-1}&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;旧的记忆单元（&lt;script type=&quot;math/tex&quot;&gt;c_{t-1}&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;h&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;旧的隐含状态（&lt;script type=&quot;math/tex&quot;&gt;h_{t-1}&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;i&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{xi}x_t+W_{hi}h_{t-1}+b_i&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Input Gate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;j&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{xc}x_t+W_{hc}h_{t-1}+b_c&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Input Modulation Gate 也就是代码解释中的new_input&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;f&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{xf}x_t+W_{hf}h_{t-1}+b_f&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Forget Gate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;o&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;W_{xo}x_t+W_{ho}h_{t-1}+b_o&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Output Gate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;new_c&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;c_t&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;新的记忆单元（&lt;script type=&quot;math/tex&quot;&gt;c_t&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;new_h&lt;/td&gt;
      &lt;td&gt;&lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;新的隐含状态（&lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt;）&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;concat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_num_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;上述代码的&lt;code class=&quot;highlighter-rouge&quot;&gt;_linear&lt;/code&gt;函数与之前RNN代码中的&lt;code class=&quot;highlighter-rouge&quot;&gt;_linear&lt;/code&gt;函数一样。在函数里面，tensorflow会自动创建基础等式中相应的&lt;script type=&quot;math/tex&quot;&gt;W_{xi}, W_{hi}, b_i, W_{xf}, W_{hf}, b_f, W_{xo}, W_{ho}, b_o, W_{xc}, W_{hc}, b_c&lt;/script&gt; 变量并初始化，在之后的过程当中，这些变量会随着输入的值的更新而不断的变化。
&lt;code class=&quot;highlighter-rouge&quot;&gt;python
i, j, f, o = array_ops.split(1, 4, concat)
&lt;/code&gt;
由于在上面的&lt;code class=&quot;highlighter-rouge&quot;&gt;_linear&lt;/code&gt;函数中，tensorflow将&lt;strong&gt;input gate, input modulation gate, forget gate和output gate&lt;/strong&gt;串联到了一起，并且他们的大小都是一致的为&lt;code class=&quot;highlighter-rouge&quot;&gt;[批尺寸大小(batch size), 隐含单元数(number of unit)]&lt;/code&gt;。所以在这个步骤当中，tensorflow通过切割数组单独获取了&lt;strong&gt;input gate, input modulation gate, forget gate和output gate&lt;/strong&gt;的值。
&lt;code class=&quot;highlighter-rouge&quot;&gt;python
new_c = (c * sigmoid(f + self._forget_bias) + sigmoid(i) *
               self._activation(j))
&lt;/code&gt;
这一段代码对应的正是基础等式中的等式&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;f_t = \sigma(W_{xf}x_t+W_{hf}h_{t-1}+b_f)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;g_t = tanh(W_{xc}x_t+W_{hc}h_{t-1}+b_c)&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;c_t = f_t\otimes c_{t-1}+i_t\otimes g_t&lt;/script&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;new_h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_activation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigmoid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这一段代码对应的则是基础等式中的
&lt;script type=&quot;math/tex&quot;&gt;h_t = o_t\otimes tanh(c_t)&lt;/script&gt;
最后tensorflow将新的隐含状态 &lt;script type=&quot;math/tex&quot;&gt;h_t&lt;/script&gt; 返回，并将新的隐含状态和新的记忆单元串联起来之后返回。&lt;/p&gt;

&lt;h2 id=&quot;section-4&quot;&gt;结束语&lt;/h2&gt;

&lt;hr /&gt;
&lt;p&gt;至此我们应该对LSTM有了一定程度上的理解，欢迎读者们在下方评论区留言发表修改意见。谢谢！&lt;/p&gt;</content><author><name>gdf</name></author><category term="lstm" /><category term="rnn" /><category term="tensorflow" /><category term="python" /><summary>目录</summary></entry><entry><title>【译】Rails测试：如何给Rails项目初始化Rspec</title><link href="http://localhost:4000/rails-rspec-initial/" rel="alternate" type="text/html" title="【译】Rails测试：如何给Rails项目初始化Rspec" /><published>2016-10-12T00:00:00-04:00</published><updated>2016-10-12T00:00:00-04:00</updated><id>http://localhost:4000/rails-rspec-initial</id><content type="html" xml:base="http://localhost:4000/rails-rspec-initial/">&lt;h2 id=&quot;section&quot;&gt;参考链接&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://rails.devcamp.com/professional-rails-development-course/application-build/rails-app-configuration&quot;&gt;link&lt;/a&gt;（本文为参考链接的非官方中文翻译版本，并非完全对照翻译，减少了原文中不必要的内容）&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;说明&lt;/h2&gt;
&lt;p&gt;这片文章将会一步一步来教大家如何初始化rspec将rspec集成到Rails的项目当中&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;文章正文：&lt;/h2&gt;
&lt;p&gt;要想充分的使用rspec，除了主要的 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec-rails&lt;/code&gt; gem，我们还需要使用到以下三个gems：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Capybara&lt;/code&gt; － 这个gem主要是用来写集成测试（integration tests），它可以模拟用户的行为来自动点击浏览器中的链接，填写浏览器中的表格等功能。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Database Cleaner&lt;/code&gt; －这个gem可以自动清除我们的test数据库，来避免一些来自rspec可能的潜在错误，例如我们想要创建唯一性的数据时，因为数据库中已经存在了相应的数据，导致该数据无法创建。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Factory Girl&lt;/code&gt; －用户创建sample数据，便于我们在rspec的测试中使用它们&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;首先让我们把相应的gem添加到&lt;code class=&quot;highlighter-rouge&quot;&gt;Gemfile&lt;/code&gt;当中（因为上述的四个gems全部都是用于测试，所以我们可以把gems添加到 &lt;code class=&quot;highlighter-rouge&quot;&gt;:development&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;:test&lt;/code&gt; 的组当中），参考一下的&lt;code class=&quot;highlighter-rouge&quot;&gt;Gemfile&lt;/code&gt;文件：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Gemfile&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'https://rubygems.org'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rails'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'4.2.5'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'pg'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 0.15'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'sass-rails'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 5.0'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'uglifier'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;gt;= 1.3.0'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'coffee-rails'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 4.1.0'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'jquery-rails'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'turbolinks'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'jbuilder'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 2.0'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'sdoc'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 0.4.0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;group: :doc&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:development&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'byebug'&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rspec-rails'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 3.0'&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'capybara'&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'database_cleaner'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:development&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'web-console'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 2.0'&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'spring'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;参考 &lt;code class=&quot;highlighter-rouge&quot;&gt;:development&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;:test&lt;/code&gt; 模块&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rspec-rails'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 3.0'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'capybara'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'database_cleaner'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;通过运行命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;bundle&lt;/code&gt; 安装需要的gem之后，我们使用rspec的命令来安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;RSpec&lt;/code&gt; 。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rails generate rspec:install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这个命令将会创建相应的rspec配置文件&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rspec&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spec_helper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rb&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rails_helper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rb&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下一步我们将需要配置 &lt;code class=&quot;highlighter-rouge&quot;&gt;rails_helper.rb&lt;/code&gt; 文件来使 &lt;code class=&quot;highlighter-rouge&quot;&gt;capybara&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;DatabaseCleaner&lt;/code&gt; 运作：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/rails_helper.rb&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'RAILS_ENV'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'test'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'../../config/environment'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;The Rails environment is running in production mode!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;production?&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'spec_helper'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rspec/rails'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'capybara/rails'&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;maintain_test_schema!&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fixture_path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/spec/fixtures&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;use_transactional_fixtures&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:suite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DatabaseCleaner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;clean_with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:truncation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DatabaseCleaner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:transaction&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:js&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DatabaseCleaner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:truncation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DatabaseCleaner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DatabaseCleaner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;clean&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;infer_spec_type_from_file_location!&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;filter_rails_from_backtrace!&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;以上的配置文件对比默认的配置文件作出了一下的修改：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;添加了 &lt;code class=&quot;highlighter-rouge&quot;&gt;capybara/rails&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;将 &lt;code class=&quot;highlighter-rouge&quot;&gt;use_transactional_fixtures&lt;/code&gt; 改变为 &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;添加了一些 &lt;code class=&quot;highlighter-rouge&quot;&gt;DatabaseCleaner&lt;/code&gt; 的配置&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;至此我们已经完成了相应的配置，下面让我们写一个测试文件来测试我们可以访问主页。创建一个目录 &lt;code class=&quot;highlighter-rouge&quot;&gt;features&lt;/code&gt; 和文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;static&lt;/code&gt; ：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/features/static_spec.rb&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rails_helper'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'navigate'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'homepage'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'can be reached successfully'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;visit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;status_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;运行命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt; 将会出现错误 &lt;code class=&quot;highlighter-rouge&quot;&gt;NameError: undefined local variable or method root_path' for #RSpec::ExampleGroups::Navigate::Homepage:0x007fa73f05eef0&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/rails-rspec-1.png&quot; alt=&quot;Alt Text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们可以通过修改 &lt;code class=&quot;highlighter-rouge&quot;&gt;routes.rb&lt;/code&gt; 文件来修复这个错误：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/routes.rb&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;draw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;to: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'static#home'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;再次运行 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt; 命令，我们将会遇到另外一个错误因为我们没有创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;static&lt;/code&gt; 控制器（controller），然后错误提示还是会说无法识别 &lt;code class=&quot;highlighter-rouge&quot;&gt;root_path&lt;/code&gt;，所以让我们手动创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;static&lt;/code&gt; 控制器：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/static_controller.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StaticController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在我们再次运行 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt; 命令，我们将会获得另外一个错误消息就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;AbstractController::ActionNotFound: The action 'home' could not be found for StaticController&lt;/code&gt; ：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/rails-rspec-2.png&quot; alt=&quot;Alt Text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们可以通过给添加 &lt;code class=&quot;highlighter-rouge&quot;&gt;home&lt;/code&gt; index：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/static_controller.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StaticController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;home&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当我们再次运行 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt; 命令， 我们将会遇到错误 &lt;code class=&quot;highlighter-rouge&quot;&gt;ActionView::MissingTemplate: Missing template static/home&lt;/code&gt; 这是因为我们没有创建模板文件，现在让我们在 &lt;code class=&quot;highlighter-rouge&quot;&gt;app/views/static&lt;/code&gt; 目录下创建文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;app/views/static/home.html.erb&lt;/code&gt; 。&lt;/p&gt;

&lt;p&gt;现在当我们运行命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt; 时，测试通过：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/rails-rspec-3.png&quot; alt=&quot;Alt Text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在测试文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;spec/features/static_spec.rb&lt;/code&gt; 中&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Capybara&lt;/code&gt; 将会开启一个虚拟的浏览器会话&lt;/li&gt;
  &lt;li&gt;它将会访问地址 &lt;code class=&quot;highlighter-rouge&quot;&gt;root_path&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;并察看相应的页面是否返回 &lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; 状态码 &lt;code class=&quot;highlighter-rouge&quot;&gt;200&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;至此改教程结束&lt;/p&gt;</content><author><name>gdf</name></author><category term="翻译" /><category term="rails" /><category term="rspec" /><summary>参考链接</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/assets/images/markdown.jpg" /></entry><entry><title>【译】自定义Devise</title><link href="http://localhost:4000/devise-customization/" rel="alternate" type="text/html" title="【译】自定义Devise" /><published>2016-10-12T00:00:00-04:00</published><updated>2016-10-12T00:00:00-04:00</updated><id>http://localhost:4000/devise-customization</id><content type="html" xml:base="http://localhost:4000/devise-customization/">&lt;h2 id=&quot;section&quot;&gt;参考链接&lt;/h2&gt;
&lt;p&gt;原文&lt;a href=&quot;https://rails.devcamp.com/professional-rails-development-course/application-build/customizing-devise&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;文章正文&lt;/h2&gt;

&lt;h3 id=&quot;devise&quot;&gt;自定义Devise&lt;/h3&gt;
&lt;p&gt;在这篇文章当中我们将会介绍如何使用&lt;code class=&quot;highlighter-rouge&quot;&gt;devise&lt;/code&gt;的一些自定义功能来满足一些特定的需求，下面列表就是需求列表&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;用户需要有以下属性&lt;code class=&quot;highlighter-rouge&quot;&gt;first_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;last_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性默认为&lt;code class=&quot;highlighter-rouge&quot;&gt;student&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;用户可以注册&lt;/li&gt;
  &lt;li&gt;用户可以登录&lt;/li&gt;
  &lt;li&gt;用户可以删除自己的账号&lt;/li&gt;
  &lt;li&gt;用户可以编辑自己的账号&lt;/li&gt;
  &lt;li&gt;用户可以修改自己的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;是一个子域名(&lt;code class=&quot;highlighter-rouge&quot;&gt;subdomain&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;是唯一的&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;不可以含有特殊的字符&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;用户必须要填写&lt;code class=&quot;highlighter-rouge&quot;&gt;first_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;last_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;假设我们已经将&lt;code class=&quot;highlighter-rouge&quot;&gt;first_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;last_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;添加到&lt;code class=&quot;highlighter-rouge&quot;&gt;users&lt;/code&gt;的表中。我们还需要添加一些新的参数，有一个需要注意的地方是，如果我们想要添加一些&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;中没有内置的参数，我们需要将这个参数添加到strong parameters当中，这样Rails才知道这些参数是有用的。&lt;/p&gt;

&lt;p&gt;让我们从写一些&lt;code class=&quot;highlighter-rouge&quot;&gt;specs&lt;/code&gt;测试开始，如果没有使用任何的自定义的区域（field），那么我们一般来说不需要测试&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;因为&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;本身就有非常完善的测试。但是当我们需要添加一些自定义的行为的时候，那么我们自定义的这些行为就需要进行测试。首先创建一个新的文件&lt;code class=&quot;highlighter-rouge&quot;&gt;user_spec.rb&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/features/user_spec.rb&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rails_helper'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user navigation'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'creation'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'can register with full set of user attributes'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;visit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_user_registration_path&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[email]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test@test.com&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[password]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[password_confirmation]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[first_name]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Jon&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[last_name]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Snow&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;fill_in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user[username]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;watcheronthewall&quot;&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;click_on&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Sign up&quot;&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have_content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Welcome&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;运行测试&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec spec/features/user_spec.rb&lt;/code&gt;将会出现以下的错误&lt;code class=&quot;highlighter-rouge&quot;&gt;Capybara::ElementNotFound: Unable to find field &quot;user[first_name]&quot;&lt;/code&gt;。这个错误是因为我们还没有添加相应的自定义区域（field），现在让我们在registration的模版（template）当中添加我们自定义的区域。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;views&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;devise&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registrations&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;erb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&amp;gt;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Sign&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;up&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/h2&amp;gt;

&amp;lt;%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %&amp;gt;
  &amp;lt;%= devise_error_messages! %&amp;gt;

  &amp;lt;div class=&quot;field&quot;&amp;gt;
    &amp;lt;%= f.label :email %&amp;gt;&amp;lt;br /&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= f.email_field :email, autofocus: true %&amp;gt;
  &amp;lt;/div&amp;gt;

  &amp;lt;div class=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= f.label :username %&amp;gt;&amp;lt;br /&amp;gt;
    &amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;text_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/div&amp;gt;

  &amp;lt;div class=&quot;field&quot;&amp;gt;
    &amp;lt;%= f.label :first_name %&amp;gt;&amp;lt;br /&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= f.text_field :first_name %&amp;gt;
  &amp;lt;/div&amp;gt;

  &amp;lt;div class=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= f.label :last_name %&amp;gt;&amp;lt;br /&amp;gt;
    &amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;text_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/div&amp;gt;

  &amp;lt;div class=&quot;field&quot;&amp;gt;
    &amp;lt;%= f.label :password %&amp;gt;
    &amp;lt;% if @minimum_password_length %&amp;gt;
    &amp;lt;em&amp;gt;(&amp;lt;%= @minimum_password_length %&amp;gt; characters minimum)&amp;lt;/em&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;% end &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;br&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/&amp;gt;
    &amp;lt;%= f.password_field :password, autocomplete: &quot;off&quot; %&amp;gt;
  &amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= f.label :password_confirmation %&amp;gt;&amp;lt;br /&amp;gt;
    &amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;autocomplete: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/div&amp;gt;

  &amp;lt;div class=&quot;actions&quot;&amp;gt;
    &amp;lt;%= f.submit &quot;Sign up&quot; %&amp;gt;
  &amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;% end &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sx&quot;&gt;%= render &quot;devise/shared/links&quot; %&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在让我们将新属性添加到strong parameters当中。创建一个新的控制器&lt;code class=&quot;highlighter-rouge&quot;&gt;registrations_controller.rb&lt;/code&gt;：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/registrations_controller.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RegistrationsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Devise&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;RegistrationsController&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sign_up_params&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;account_update_params&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:current_password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这个将会拓展默认的&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;控制器，然后添加一些新的自定义的属性，我们将会在我们的注册的表中使用到这些属性。最后我们需要修改路由（route）文件&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/routes.rb&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;draw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;devise_for&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;controllers: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;registrations: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'registrations'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;to: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'static#home'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;让我们再次运行测试&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;时，所有的测试将会通过。这时我们可以开启服务器&lt;code class=&quot;highlighter-rouge&quot;&gt;rails s&lt;/code&gt;然后使用浏览器访问页面&lt;code class=&quot;highlighter-rouge&quot;&gt;localhost:3000/users/sign_up&lt;/code&gt;，将会看到新的区域。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/devise_custom_params_form.png&quot; alt=&quot;Alt text&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;用户的role属性默认值为student&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;用户的role属性应该由系统控制，用户将无法做出任何的更改。让我们来通过修改rails生成（&lt;code class=&quot;highlighter-rouge&quot;&gt;rails generate model User&lt;/code&gt; ）的&lt;code class=&quot;highlighter-rouge&quot;&gt;user_spec.rb&lt;/code&gt;文件来添加这个功能的测试：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/models/user_spec.rb&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rails_helper'&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;type: :model&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'creation'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;before&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;email: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test@test.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password_confirmation: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Jon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Snow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;username: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;watcheronthewall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should be able to be created if valid'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should have a default role of: student'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'student'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这里面有两个测试，其中一个测试将会正常通过因为我们知道&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;将会被成功创建，第二个测试将会失败，因为这个测试是来检查&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;默认的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;是否为&lt;code class=&quot;highlighter-rouge&quot;&gt;Student&lt;/code&gt;。运行&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec spec/models&lt;/code&gt;，我们将会发现以下的错误：&lt;code class=&quot;highlighter-rouge&quot;&gt;NoMethodError: undefined methodrole' for #User:0x007fd2b09991e0&lt;/code&gt;。下面让我们来创建一个迁移文件来修复这个错误：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;rails&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;migration&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;add_role_to_users&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:string&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当我们运行了&lt;code class=&quot;highlighter-rouge&quot;&gt;rake db:migrate&lt;/code&gt;之后，将会添加一个&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性到&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;的数据库当中，现在我们重新运行测试&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec spec/models&lt;/code&gt;，我们将会获得一个不同的错误&lt;code class=&quot;highlighter-rouge&quot;&gt;expected: &quot;student&quot;, got: nil&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/1475505387332.png&quot; alt=&quot;Alt text&quot; /&gt;&lt;/p&gt;

&lt;p&gt;现在让我们添加一个回调函数到&lt;code class=&quot;highlighter-rouge&quot;&gt;user.rb&lt;/code&gt;当中，来默认创建用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/user.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;devise&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:database_authenticatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:registerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;ss&quot;&gt;:recoverable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:rememberable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:trackable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:validatable&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;after_initialize&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:set_defaults&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set_defaults&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;role&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'student'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;after_initialize&lt;/code&gt;是一个回调函数，这个函数将会在&lt;code class=&quot;highlighter-rouge&quot;&gt;User&lt;/code&gt;模型初始化的时候被调用。这里我们不使用&lt;code class=&quot;highlighter-rouge&quot;&gt;after_create&lt;/code&gt;的原因是因为&lt;code class=&quot;highlighter-rouge&quot;&gt;after_create&lt;/code&gt;将会复写我们实时修改的信息。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;set_defaults&lt;/code&gt;是一个自定义的方法，用于设置默认值。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;self.role ||= 'student'&lt;/code&gt;如果&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;的值为&lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt;则把&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;设置为&lt;code class=&quot;highlighter-rouge&quot;&gt;'student'&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当我们再次运行&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;时，所有的测试将会通过。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;现在让我们回到&lt;strong&gt;用户必须有&lt;code class=&quot;highlighter-rouge&quot;&gt;first name&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;last name&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;&lt;/strong&gt;的这个需求上来。为了实现这个需求，我们需要添加一些&lt;code class=&quot;highlighter-rouge&quot;&gt;validations&lt;/code&gt;到&lt;code class=&quot;highlighter-rouge&quot;&gt;user.rb&lt;/code&gt;文件当中，但是首先让我们添加一些新的&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;测试：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/models/user_spec.rb&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rails_helper'&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;type: :model&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'creation'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;before&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;email: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test@test.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password_confirmation: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Jon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Snow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;username: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;watcheronthewall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should be able to be created if valid'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should have a default role of: student'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'student'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;describe&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'validations'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should not be valid without a first name'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should not be valid without a last name'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;last_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should not be valid without a username'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;运行&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec spec/models&lt;/code&gt;将会给我们三个错误，错误内容为&lt;code class=&quot;highlighter-rouge&quot;&gt;Failure/Error: expect(@user).to_not be_valid&lt;/code&gt;。让我们给我们的&lt;code class=&quot;highlighter-rouge&quot;&gt;user.rb&lt;/code&gt;文件添加以下的&lt;code class=&quot;highlighter-rouge&quot;&gt;validations&lt;/code&gt;：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/user.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Include default devise modules. Others available are:&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# :confirmable, :lockable, :timeoutable and :omniauthable&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;devise&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:database_authenticatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:registerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;ss&quot;&gt;:recoverable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:rememberable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:trackable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:validatable&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;after_initialize&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:set_defaults&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;validates_presence_of&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set_defaults&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;role&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'student'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;再次运行&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;将会发现所有的测试都会通过。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;现在让我们回顾一下我们的需求：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;用户需要有以下属性&lt;code class=&quot;highlighter-rouge&quot;&gt;first_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;last_name&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; - &lt;strong&gt;完成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性默认为&lt;code class=&quot;highlighter-rouge&quot;&gt;student&lt;/code&gt; - &lt;strong&gt;完成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户可以注册 - &lt;strong&gt;devise自动生成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户可以登录 - &lt;strong&gt;devise自动生成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户可以删除自己的账号 - &lt;strong&gt;devise自动生成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户可以编辑自己的账号 - &lt;strong&gt;devise自动生成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户可以修改自己的&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性 - &lt;strong&gt;完成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;是一个子域名(&lt;code class=&quot;highlighter-rouge&quot;&gt;subdomain&lt;/code&gt;) - &lt;strong&gt;稍后会完成&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;是唯一的&lt;/li&gt;
  &lt;li&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;不可以含有特殊的字符&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;现在让我们来完成需求：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;是唯一的&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;首先让我们来添加一些新的测试到测试文件中来：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/models/user_spec.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should ensure that all usernames are unique'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;duplicate_username_user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;email: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test2@test.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password_confirmation: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;first_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Joni&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;last_name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Snowy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;username: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;watcheronthewall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;duplicate_username_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;运行测试我们将会发现以下错误&lt;code class=&quot;highlighter-rouge&quot;&gt;Failure/Error: expect(duplicate_username_user).to_not be_valid&lt;/code&gt;。下一步让我们来更新&lt;code class=&quot;highlighter-rouge&quot;&gt;user.rb&lt;/code&gt;文件：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/user.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;validates_uniqueness_of&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当我们再次运行&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;时，所有的测试将会通过。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;现在让我们实现最后的一个需求。&lt;strong&gt;用户的&lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt;不可以含有特殊的字符&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;因为我们的用户名最终将会成为子域名（subdomain），所以用户名中将不能包含任何的特殊字符，类似于&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;*$&amp;amp;*@&lt;/code&gt;。首先我们添加&lt;code class=&quot;highlighter-rouge&quot;&gt;rspec&lt;/code&gt;测试：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# spec/models/user_spec.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'should ensure that usernames do not allow special characters'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*#*(@!&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be_valid&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;运行测试将会给出相应的错误提示消息，现在让我们来修改&lt;code class=&quot;highlighter-rouge&quot;&gt;user.rb&lt;/code&gt;文件：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/user.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Include default devise modules. Others available are:&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# :confirmable, :lockable, :timeoutable and :omniauthable&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;devise&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:database_authenticatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:registerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;ss&quot;&gt;:recoverable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:rememberable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:trackable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:validatable&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;after_initialize&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:set_defaults&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;validates_presence_of&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_name&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;uniqueness: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;format: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with: &lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\A[a-zA-Z]+([a-zA-Z]|\d)*\Z/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set_defaults&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;role&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'student'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在当我们再次运行测试时，所有的测试将会通过。&lt;/p&gt;

&lt;h3 id=&quot;httpsgithubcomrails-campdailysmartytreea795d2b8a40fc742e534f0dae27b8adb956d19d7&quot;&gt;参考&lt;a href=&quot;https://github.com/rails-camp/dailysmarty/tree/a795d2b8a40fc742e534f0dae27b8adb956d19d7&quot;&gt;代码&lt;/a&gt;&lt;/h3&gt;</content><author><name>gdf</name></author><category term="翻译" /><category term="devise" /><category term="rails" /><summary>参考链接
原文链接</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/assets/images/markdown.jpg" /></entry><entry><title>【译】Devise的用法</title><link href="http://localhost:4000/devise-usage/" rel="alternate" type="text/html" title="【译】Devise的用法" /><published>2016-10-11T00:00:00-04:00</published><updated>2016-10-11T00:00:00-04:00</updated><id>http://localhost:4000/devise-usage</id><content type="html" xml:base="http://localhost:4000/devise-usage/">&lt;h2 id=&quot;section&quot;&gt;参考链接&lt;/h2&gt;
&lt;p&gt;原文&lt;a href=&quot;https://rails.devcamp.com/trails/ruby-gem-walkthroughs/campsites/authentication/guides/devise&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;文章正文&lt;/h2&gt;

&lt;h3 id=&quot;devise-&quot;&gt;Devise 能做什么&lt;/h3&gt;
&lt;p&gt;用户的认证功能对于新的Rails开发者来说是一件非常困难的事情， 而 &lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt; 是一个非常全面的用户认证&lt;code class=&quot;highlighter-rouge&quot;&gt;gem&lt;/code&gt;，提供了以下一些重要的功能：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;注册&lt;/li&gt;
  &lt;li&gt;登录／登出&lt;/li&gt;
  &lt;li&gt;会话管理（可以知道用户是否登录当他们使用网站的时候）&lt;/li&gt;
  &lt;li&gt;密码重设&lt;/li&gt;
  &lt;li&gt;可以自动生成&lt;code class=&quot;highlighter-rouge&quot;&gt;View&lt;/code&gt;模板，便于你用于参考。&lt;/li&gt;
  &lt;li&gt;可以自动生成模型(model)&lt;/li&gt;
  &lt;li&gt;可以集成诸如&lt;code class=&quot;highlighter-rouge&quot;&gt;Facebook&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Twitter&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;wechat&lt;/code&gt;等网站的一键登录功能(OAuth2)&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;devise&quot;&gt;为什么使用 Devise&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Deivse&lt;/code&gt;之所以如此受欢迎的主要原因，是因为它能够很快的帮助开发者建立起很全面的用户的认证系统，并且它非常稳定有专业的人员来做持续的维护工作。
在安全方面，&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;也包含了许多重要的功能来保证安全性，它可以自动加密／解密密码，重设密码等。总体来说，它可以很大程度的保证我们用户认证系统的安全性。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;缺点&lt;/h3&gt;
&lt;p&gt;如果你想要复写&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;中的一些默认的功能，将会变的非常困难。比如说如果你想让一个用户使用用户名登录而不是邮件登陆，那么这个的难度可能跟你从头创建一个&lt;code class=&quot;highlighter-rouge&quot;&gt;Auth&lt;/code&gt;的系统一样。
还有当你想要添加自己的参数到&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;的模块当中时，比如说把&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性添加到&lt;code class=&quot;highlighter-rouge&quot;&gt;users&lt;/code&gt;模型当中，我们就需要来修改&lt;code class=&quot;highlighter-rouge&quot;&gt;ApplicationController&lt;/code&gt;来吧&lt;code class=&quot;highlighter-rouge&quot;&gt;role&lt;/code&gt;属性添加到白名单当中，这会感觉很奇怪因为正常来说我们应该修改的是对应模型本身的&lt;code class=&quot;highlighter-rouge&quot;&gt;controller&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;devise-1&quot;&gt;实现／Devise实例&lt;/h3&gt;
&lt;p&gt;让我们现在开始集成&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;到我们的项目当中，首先我们需要到&lt;a href=&quot;https://rubygems.org/gems/devise/versions/3.5.3&quot;&gt;rubygems.org&lt;/a&gt;中获取最新的稳定版本，然后将相应的&lt;code class=&quot;highlighter-rouge&quot;&gt;gem&lt;/code&gt;添加到我们项目的&lt;code class=&quot;highlighter-rouge&quot;&gt;Gemfile&lt;/code&gt;当中。&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'devise'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'~&amp;gt; 3.5'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;gt;= 3.5.3'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后我们运行&lt;code class=&quot;highlighter-rouge&quot;&gt;bundle install&lt;/code&gt;来安装相应的文件，安装完成之后，我们可以运行生成器(generator):&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rails generate devise:install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这将会创建以下两个文件&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;create  config/initializers/devise.rb
create  config/locales/devise.en.yml
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在我们开始做其他任何事情之间，我们需要首先打开文件&lt;code class=&quot;highlighter-rouge&quot;&gt;config/initializers/devise.rb&lt;/code&gt;然后将文件当中的默认邮件的属性修改成我们对应的邮件地址：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mailer_sender&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'please-change-me-at-config-initializers-devise@example.com'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;修改为&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mailer_sender&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'no-reply@gdf.name'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后我们可以查看&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;在终端中打印出来的帮助文档&lt;/p&gt;

&lt;div class=&quot;language-tex highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Some setup you must do manually if you haven't yet:

  1. Ensure you have defined default url options in your environments files. Here
     is an example of default&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;url&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;options appropriate for a development environment
     in config/environments/development.rb:

       config.action&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;mailer.default&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;url&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;options = &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; host: 'localhost', port: 3000 &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

     In production, :host should be set to the actual host of your application.

  2. Ensure you have defined root&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;url to *something* in your config/routes.rb.
     For example:

       root to: &quot;home#index&quot;

  3. Ensure you have flash messages in app/views/layouts/application.html.erb.
     For example:

       &amp;lt;p class=&quot;notice&quot;&amp;gt;&amp;lt;&lt;span class=&quot;c&quot;&gt;%= notice %&amp;gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
       &amp;lt;p class=&quot;alert&quot;&amp;gt;&amp;lt;&lt;span class=&quot;c&quot;&gt;%= alert %&amp;gt;&amp;lt;/p&amp;gt;&lt;/span&gt;

  4. If you are deploying on Heroku with Rails 3.2 only, you may want to set:

       config.assets.initialize&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;on&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;precompile = false

     On config/application.rb forcing your application to not access the DB
     or load models when precompiling your assets.

  5. You can copy Devise views (for customization) to your app by running:

       rails g devise:views 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我们可以根据上面的提示来一步一步的完成&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;的配置&lt;/p&gt;

&lt;p&gt;1.添加一个新的配置选项到&lt;code class=&quot;highlighter-rouge&quot;&gt;config/environments/development.rb&lt;/code&gt;配置文件当中（如果是一个生产服务器那么你将会需要修改文件&lt;code class=&quot;highlighter-rouge&quot;&gt;config/environments/production.rb&lt;/code&gt;）。在&lt;code class=&quot;highlighter-rouge&quot;&gt;configure&lt;/code&gt;的代码块中，添加如下的代码：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/environments/development.rb&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;action_mailer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;default_url_options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;host: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'localhost'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;port: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;2.请确认你有一个&lt;code class=&quot;highlighter-rouge&quot;&gt;homepage&lt;/code&gt;， 如果没有的话你需要首先修改文件&lt;code class=&quot;highlighter-rouge&quot;&gt;config/routes.rb&lt;/code&gt;如下：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/routes.rb&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;to: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pages#home'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其次你需要创建一个控制器文件&lt;code class=&quot;highlighter-rouge&quot;&gt;app/controllers/pages_controllers.rb&lt;/code&gt;然后添加以下代码：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/pages_controller.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PagesController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;home&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;3.创建一个&lt;code class=&quot;highlighter-rouge&quot;&gt;pages&lt;/code&gt;目录然后创建文件&lt;code class=&quot;highlighter-rouge&quot;&gt;app/views/pages/home.html.erb&lt;/code&gt;，并将以下的代码写入到文件&lt;code class=&quot;highlighter-rouge&quot;&gt;application.html.erb&lt;/code&gt;当中（在&lt;code class=&quot;highlighter-rouge&quot;&gt;yield&lt;/code&gt;代码的上方）:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%#= app/views/layouts/application.html.erb %&amp;gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;notice&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%= notice %&amp;gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;alert&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%= alert %&amp;gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;4.因为我们现在的&lt;code class=&quot;highlighter-rouge&quot;&gt;Rails&lt;/code&gt;版本远超3.2，所以我们不需要做这一步的操作&lt;/p&gt;

&lt;p&gt;5.使用&lt;code class=&quot;highlighter-rouge&quot;&gt;Deivse&lt;/code&gt;generator创建视图（view）控件，在终端中运行命令&lt;code class=&quot;highlighter-rouge&quot;&gt;rails g devise:views&lt;/code&gt;将会创建如下的文件：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;app/views/devise/shared/_links.html.erb
app/views/devise/confirmations/new.html.erb
app/views/devise/passwords/edit.html.erb
app/views/devise/passwords/new.html.erb
app/views/devise/registrations/edit.html.erb
app/views/devise/registrations/new.html.erb
app/views/devise/sessions/new.html.erb
app/views/devise/unlocks/new.html.erb
app/views/devise/mailer/confirmation_instructions.html.erb
app/views/devise/mailer/password_change.html.erb
app/views/devise/mailer/reset_password_instructions.html.erb
app/views/devise/mailer/unlock_instructions.html.erb
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;上面的这些文件的创建将会给我们足够的代码来实现下列的功能：用户注册， 用户登录，用户编辑账户详情，用户重设密码和一些可以选择的功能，例如确认账号。&lt;/p&gt;

&lt;p&gt;现在我们已经将所有的视图文件配置完毕，我们可以开始创建模型（model）文件，在终端中运行命令&lt;code class=&quot;highlighter-rouge&quot;&gt;rails g devise User&lt;/code&gt;。这行代码将会创建一个模型（model）文件和一个迁移（migration）文件。迁移文件如下：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# db/migrate/20160115010323_devise_create_users.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DeviseCreateUsers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;## Database authenticatable&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;              &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:encrypted_password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;## Recoverable&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;:reset_password_token&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:reset_password_sent_at&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;## Rememberable&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:remember_created_at&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;## Trackable&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt;  &lt;span class=&quot;ss&quot;&gt;:sign_in_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;default: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:current_sign_in_at&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;datetime&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:last_sign_in_at&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;:current_sign_in_ip&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;:last_sign_in_ip&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;## Confirmable&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.string   :confirmation_token&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.datetime :confirmed_at&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.datetime :confirmation_sent_at&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.string   :unconfirmed_email # Only if using reconfirmable&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;## Lockable&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.integer  :failed_attempts, default: 0, null: false # Only if lock strategy is :failed_attempts&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.string   :unlock_token # Only if unlock strategy is :email or :both&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# t.datetime :locked_at&lt;/span&gt;


      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;timestamps&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;null: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                &lt;span class=&quot;ss&quot;&gt;unique: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:reset_password_token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;unique: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# add_index :users, :confirmation_token,   unique: true&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# add_index :users, :unlock_token,         unique: true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;从上述的文件当中，我们可以看到&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;给我们的标准属性有些什么，例如&lt;code class=&quot;highlighter-rouge&quot;&gt;email&lt;/code&gt;和&lt;code class=&quot;highlighter-rouge&quot;&gt;password&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;Deivse&lt;/code&gt;也提供了相应的属性来跟踪记录用户的登录次数，还有许多其他的功能。默认情况下&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;注释掉了&lt;code class=&quot;highlighter-rouge&quot;&gt;confirmable&lt;/code&gt;属性，如果你取消了注释，那么用户将会收到邮件来激活相应的账号才可以使用。这是一个很有用的功能，但是很多情况下确认的邮件将会发送到用户的垃圾收件箱当中并且会有一定的延迟。&lt;/p&gt;

&lt;p&gt;现在让我们在终端中运行命令&lt;code class=&quot;highlighter-rouge&quot;&gt;rake db:migrate&lt;/code&gt;这将会在数据库中创建&lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt;列表。最后使用命令&lt;code class=&quot;highlighter-rouge&quot;&gt;rails s&lt;/code&gt;运行服务器，在浏览器中输入地址&lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:3000/users/sign_up&lt;/code&gt;你就可以注册账号然后使用注册好的账号访问&lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:3000/users/sign_in&lt;/code&gt;来登录系统。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;有趣的功能&lt;/h3&gt;

&lt;p&gt;1.了解用户是否登录
将如下的代码添加到&lt;code class=&quot;highlighter-rouge&quot;&gt;homepage&lt;/code&gt;当中：&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%#= app/views/pages/home.html.erb %&amp;gt;

&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;% if current_user %&amp;gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;I'm signed in&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;% else %&amp;gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;I'm not signed in&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;% end %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首先登陆系统，你将会看到消息&lt;code class=&quot;highlighter-rouge&quot;&gt;I'm signed in&lt;/code&gt;，然后打开一个匿名的浏览器窗口（chrome打开的方法为 MAC: &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd+shift+n&lt;/code&gt; Windows: &lt;code class=&quot;highlighter-rouge&quot;&gt;ctrl+shift+n&lt;/code&gt;）访问主页你将会看到提示&lt;code class=&quot;highlighter-rouge&quot;&gt;I'm not signed in&lt;/code&gt;。这是因为&lt;code class=&quot;highlighter-rouge&quot;&gt;current_user&lt;/code&gt;这个属性是&lt;code class=&quot;highlighter-rouge&quot;&gt;Devise&lt;/code&gt;的内置功能来查看一个用户是否登录。&lt;/p&gt;

&lt;p&gt;2.强制用户登录&lt;/p&gt;

&lt;p&gt;当我们想让强制用户登录之后才能查看某些页面时，我们可以使用方法&lt;code class=&quot;highlighter-rouge&quot;&gt;authenticate_user!&lt;/code&gt;来保证用户必须登录了之后才能查看页面。在本项目中我们可以修改&lt;code class=&quot;highlighter-rouge&quot;&gt;PagesControllers&lt;/code&gt;：&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/pages_controller.rb&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PagesController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;home&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;authenticate_user!&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在如果未登录的用户访问主页的时候将会自动跳转到登录界面，并且提示&lt;code class=&quot;highlighter-rouge&quot;&gt;You need to sign in or sign up before continuing.&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;项目代码&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/rails-camp/gem-review-devise&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;</content><author><name>gdf</name></author><category term="翻译" /><category term="devise" /><category term="rails" /><summary>参考链接
原文链接</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/assets/images/markdown.jpg" /></entry><entry><title>Computer vision annotation program</title><link href="http://localhost:4000/cv-annotation/" rel="alternate" type="text/html" title="Computer vision annotation program" /><published>2016-06-18T00:00:00-04:00</published><updated>2016-06-18T00:00:00-04:00</updated><id>http://localhost:4000/cv-annotation</id><content type="html" xml:base="http://localhost:4000/cv-annotation/">&lt;p&gt;&lt;img src=&quot;/assets/images/projects/cv-annotation.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;github&quot;&gt;Github&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/asolis/Annotate&quot;&gt;link&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;contributions&quot;&gt;Contributions&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;add the action annotation function to the program&lt;/li&gt;
  &lt;li&gt;refactor the tracker function in the program&lt;/li&gt;
  &lt;li&gt;create the XML annotation file import and export function&lt;/li&gt;
&lt;/ol&gt;</content><author><name>gdf</name></author><category term="c++" /><category term="opencv" /><summary></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/assets/images/projects/cv-annotation.png" /></entry><entry><title>Wordpress Websites</title><link href="http://localhost:4000/wordpress-websites/" rel="alternate" type="text/html" title="Wordpress Websites" /><published>2016-05-17T00:00:00-04:00</published><updated>2016-05-17T00:00:00-04:00</updated><id>http://localhost:4000/wordpress-websites</id><content type="html" xml:base="http://localhost:4000/wordpress-websites/">&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.mamituojiao.com/&quot;&gt;mamituojiao&lt;/a&gt; A Company that focusing on young children education in Henan, China&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/images/projects/wp-mamituojiao.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://sis2spa.com&quot;&gt;sis2spa&lt;/a&gt; A SPA located in Ottawa, Canada&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/images/projects/wp-sis2spa.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.gdf.name&quot;&gt;www.gdf.name&lt;/a&gt; My personal wordpress website&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/images/projects/wp-personal.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;</content><author><name>gdf</name></author><category term="wordpress" /><summary>mamituojiao A Company that focusing on young children education in Henan, China</summary></entry><entry><title>[Reference] Markdown Common Elements</title><link href="http://localhost:4000/markdown-common-elements/" rel="alternate" type="text/html" title="[Reference] Markdown Common Elements" /><published>2016-02-24T22:44:00-05:00</published><updated>2016-02-24T22:44:00-05:00</updated><id>http://localhost:4000/markdown-common-elements</id><content type="html" xml:base="http://localhost:4000/markdown-common-elements/">&lt;h2 id=&quot;summary&quot;&gt;Summary:&lt;/h2&gt;

&lt;p&gt;You can pick as item to see how to apply in markdown.&lt;/p&gt;

&lt;h3 id=&quot;comum-elements&quot;&gt;Comum Elements&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#basic-formatting&quot;&gt;Basic formatting&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#headings&quot;&gt;Headings&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#lists&quot;&gt;Lists&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#paragraph-modifiers&quot;&gt;Paragraph Modifiers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#urls&quot;&gt;Urls&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#horizontal-rule&quot;&gt;Horizontal Rule&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#images&quot;&gt;Images&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#code&quot;&gt;Code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;basic-formatting&quot;&gt;Basic formatting&lt;/h2&gt;

&lt;p&gt;This note &lt;strong&gt;demonstrates&lt;/strong&gt; some of what &lt;a href=&quot;http://daringfireball.net/projects/markdown/&quot;&gt;Markdown&lt;/a&gt; is &lt;em&gt;capable of doing&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;And that’s how to do it.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;This note **demonstrates** some of what [Markdown][some/link] is *capable of doing*.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;headings&quot;&gt;Headings&lt;/h2&gt;

&lt;p&gt;There are six levels of headings. They correspond with the six levels of HTML headings. You’ve probably noticed them already in the page. Each level down uses one more hash character. But we are using just 4 of them.&lt;/p&gt;

&lt;h1 id=&quot;headings-can-be-small&quot;&gt;Headings can be small&lt;/h1&gt;

&lt;h2 id=&quot;headings-can-be-small-1&quot;&gt;Headings can be small&lt;/h2&gt;

&lt;h3 id=&quot;headings-can-be-small-2&quot;&gt;Headings can be small&lt;/h3&gt;

&lt;h4 id=&quot;headings-can-be-small-3&quot;&gt;Headings can be small&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;# Heading
## Heading
### Heading
#### Heading&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;lists&quot;&gt;Lists&lt;/h2&gt;

&lt;h3 id=&quot;ordered-list&quot;&gt;Ordered list&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Item 1&lt;/li&gt;
  &lt;li&gt;A second item&lt;/li&gt;
  &lt;li&gt;Number 3&lt;/li&gt;
&lt;/ol&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;1. Item 1
2. A second item
3. Number 3&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;unordered-list&quot;&gt;Unordered list&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;An item&lt;/li&gt;
  &lt;li&gt;Another item&lt;/li&gt;
  &lt;li&gt;Yet another item&lt;/li&gt;
  &lt;li&gt;And there’s more…&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;* An item
* Another item
* Yet another item
* And there's more...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;paragraph-modifiers&quot;&gt;Paragraph modifiers&lt;/h2&gt;

&lt;h3 id=&quot;quote&quot;&gt;Quote&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Here is a quote. What this is should be self explanatory. Quotes are automatically indented when they are used.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;&amp;gt; Here is a quote. What this is should be self explanatory.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;urls&quot;&gt;URLs&lt;/h2&gt;

&lt;p&gt;URLs can be made in a handful of ways:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A named link to &lt;a href=&quot;http://www.markitdown.net/&quot;&gt;Mark It Down&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Another named link to &lt;a href=&quot;http://markitdown.net/&quot;&gt;Mark It Down&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Sometimes you just want a URL like &lt;a href=&quot;http://markitdown.net/&quot;&gt;http://markitdown.net/&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;* A named link to [MarkItDown][3].
* Another named link to [MarkItDown](http://markitdown.net/)
* Sometimes you just want a URL like &amp;lt;http://markitdown.net/&amp;gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;horizontal-rule&quot;&gt;Horizontal rule&lt;/h2&gt;

&lt;p&gt;A horizontal rule is a line that goes across the middle of the page.
It’s sometimes handy for breaking things up.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;---&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;images&quot;&gt;Images&lt;/h2&gt;

&lt;p&gt;Markdown can also contain images. I’ll need to add something here sometime.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;![Markdowm Image][/image/url]&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;http://kune.fr/wp-content/uploads/2013/10/ghost-blog.jpg&quot; alt=&quot;Markdowm Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Figure Caption&lt;/em&gt;?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;![Markdowm Image][/image/url]
&amp;lt;figcaption class=&quot;caption&quot;&amp;gt;Photo by John Doe&amp;lt;/figcaption&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;http://kune.fr/wp-content/uploads/2013/10/ghost-blog.jpg&quot; alt=&quot;Markdowm Image&quot; /&gt;&lt;/p&gt;
&lt;figcaption class=&quot;caption&quot;&gt;Photo by John Doe&lt;/figcaption&gt;

&lt;p&gt;&lt;em&gt;Bigger Images&lt;/em&gt;?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-raw&quot; data-lang=&quot;raw&quot;&gt;![Markdowm Image][/image/url]{: class=&quot;bigger-image&quot; }&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;http://kune.fr/wp-content/uploads/2013/10/ghost-blog.jpg&quot; alt=&quot;Markdowm Image&quot; class=&quot;bigger-image&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;code&quot;&gt;Code&lt;/h2&gt;

&lt;p&gt;A HTML Example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Document&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Just a test&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A CSS Example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt;&lt;span class=&quot;nt&quot;&gt;pre&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;.8em&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;white-space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;tt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Monaco&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Consolas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Inconsolata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;monospace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rgba&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A JS Example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Sticky Header&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scroll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scrollTop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;900&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;body&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'show-menu'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'#hamburguer__open'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fadeOut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fast'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;body&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'show-menu'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'#hamburguer__open'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fadeIn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fast'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;</content><author><name>gdf</name></author><category term="markdown" /><summary>Summary:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/assets/images/markdown.jpg" /></entry></feed>
